pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git url: 'https://github.com/KonDrozdz/Python-test-app-jenkins.git', branch: 'main'
            }
        }
        
        stage('Find Python') {
            steps {
                sh '''
                    # Sprawdź dostępne wersje Pythona
                    echo "Szukam Pythona w systemie..."
                    which python3 || which python || echo "Python nie znaleziony"
                    
                    # Jeśli python3 jest dostępny, użyj go
                    if command -v python3 &> /dev/null; then
                        echo "Używam python3"
                        python3 -m pip install --user -r requirements.txt
                        python3 -m pytest tests/ --junitxml=test-results.xml
                    elif command -v python &> /dev/null; then
                        echo "Używam python"
                        python -m pip install --user -r requirements.txt
                        python -m pytest tests/ --junitxml=test-results.xml
                    else
                        echo "ERROR: Python nie jest dostępny w systemie"
                        exit 1
                    fi
                '''
            }
            post {
                always {
                    junit 'test-results.xml'
                }
            }
        }
    }
}
